<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Mockito and Dependency Injection - Random Code Ramblings</title>
<meta name="description" content="When writing your Java unit test you will soon need a way to handle the dependencies of your classes under test. Mockito have some nice features that simplify the creation and usage of mock objects that have improved gradually during the last couple of years.">


  <meta name="author" content="Mattias Severson">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Random Code Ramblings">
<meta property="og:title" content="Mockito and Dependency Injection">
<meta property="og:url" content="https://matsev.github.io/blog/2012/02/25/mockito-and-dependency-injection/">


  <meta property="og:description" content="When writing your Java unit test you will soon need a way to handle the dependencies of your classes under test. Mockito have some nice features that simplify the creation and usage of mock objects that have improved gradually during the last couple of years.">







  <meta property="article:published_time" content="2012-02-25T00:00:00+01:00">






<link rel="canonical" href="https://matsev.github.io/blog/2012/02/25/mockito-and-dependency-injection/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Mattias Severson",
      "url": "https://matsev.github.io/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Random Code Ramblings Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Random Code Ramblings
          <span class="site-subtitle">offloading a software engineer's mind</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/blog/" title="Software related blog posts">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/talks/" title="Presentations that I have made">Talks</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" title="Information about me and this web site">About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/mattias-severson.jpg" alt="Mattias Severson" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Mattias Severson</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Senior Software Consultant</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Malmö, Sweden</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      

      

      

      

      
        <li>
          <a href="https://twitter.com/mattiasseverson" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span>
          </a>
        </li>
      

      

      
        <li>
          <a href="https://www.linkedin.com/in/matsev" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span>
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/matsev" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span>
          </a>
        </li>
      

      

      
        <li>
          <a href="https://stackoverflow.com/users/303598/matsev" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Mockito and Dependency Injection">
    <meta itemprop="description" content="When writing your Java unit test you will soon need a way to handle the dependencies of your classes under test. Mockito have some nice features that simplify the creation and usage of mock objects that have improved gradually during the last couple of years.">
    <meta itemprop="datePublished" content="2012-02-25T00:00:00+01:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Mockito and Dependency Injection
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#class-under-test">Class under test</a></li>
  <li><a href="#the-mockito-way">The Mockito way</a></li>
  <li><a href="#limitations">Limitations</a></li>
  <li><a href="#dependency">Dependency</a></li>
  <li><a href="#references">References</a></li>
</ul>

            </nav>
          </aside>
        
        <p>When writing your Java unit test you will soon need a way to handle the dependencies of your classes under test. <a href="http://code.google.com/p/mockito/">Mockito</a> have some nice features that simplify the creation and usage of mock objects that have improved gradually during the last couple of years.</p>

<h2 id="class-under-test">Class under test</h2>

<p>Imagine that you write an <code class="language-plaintext highlighter-rouge">Example</code> class that has a <code class="language-plaintext highlighter-rouge">Delegate</code> dependency. It may be implemented as a POJO with constructor injection:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Delegate</span> <span class="n">delegate</span><span class="o">;</span>

    <span class="nc">Example</span><span class="o">(</span><span class="nc">Delegate</span> <span class="n">delegate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">delegate</span> <span class="o">=</span> <span class="n">delegate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doIt</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">delegate</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Alternatively, it could be rewritten using setter injection based on Java EE 6 / JSR 330 annotations:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Named</span><span class="o">(</span><span class="s">"example"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Delegate</span> <span class="n">delegate</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kt">void</span> <span class="nf">setDelegate</span><span class="o">(</span><span class="nc">Delegate</span> <span class="n">delegate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">delegate</span> <span class="o">=</span> <span class="n">delegate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doIt</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">delegate</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>It could also be a Spring bean based on field injection:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span><span class="o">(</span><span class="s">"example"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">Delegate</span> <span class="n">delegate</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doIt</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">delegate</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>There are more ways to refactor this class, but you get the point.</p>

<h2 id="the-mockito-way">The Mockito way</h2>

<p>It turns out that all these examples can be verified using the same Mockito test:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="nc">MockitoJUnitRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleTest</span> <span class="o">{</span>

    <span class="nd">@Mock</span>
    <span class="nc">Delegate</span> <span class="n">delegateMock</span><span class="o">;</span>

    <span class="nd">@InjectMocks</span>
    <span class="nc">Example</span> <span class="n">example</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDoIt</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">example</span><span class="o">.</span><span class="na">doIt</span><span class="o">();</span>

        <span class="n">verify</span><span class="o">(</span><span class="n">delegateMock</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The interesting part of this test is the code that is <em>not</em> there. You may be surprised to find that the test does not contain the traditional boilerplate code associated with jUnit tests such as a <code class="language-plaintext highlighter-rouge">@Before</code> method, there is no <code class="language-plaintext highlighter-rouge">new Example()</code> call that instantiates the class under test, nor any application context from which an example bean can be obtained. Moreover, there is no call to the <a href="http://docs.mockito.googlecode.com/hg/1.9.0/org/mockito/Mockito.html#mock%28java.lang.Class%29">mock()</a> method to create the delegate mock object. Despite all this, an <code class="language-plaintext highlighter-rouge">Example</code> instance will be created, a mock object will be injected into it, and the test will execute and pass. When the <a href="http://docs.mockito.googlecode.com/hg/1.9.0/org/mockito/runners/MockitoJUnitRunner.html">MockitoJUnitRunner</a> executes the test, Mockito creates mocks and spies instances for all fields that are annotated with the <a href="http://docs.mockito.googlecode.com/hg/1.9.0/org/mockito/Mock.html">@Mock</a> or the <a href="http://docs.mockito.googlecode.com/hg/1.9.0/org/mockito/Spy.html">@Spy</a> annotations. Next, the field declaration that is annotated with the <a href="http://docs.mockito.googlecode.com/hg/1.9.0/org/mockito/InjectMocks.html">@InjectMocks</a> annotation is instantiated and Mockito injects the mocks and spies into it. This occurs before each test method, so there is no there is no residual state left from any previous test that may affect the current test. From this part onwards, the test behaves like any other test and you can write your assertions and verifications as usual. As can be seen from the above examples, Mockito supports dependency injection by using constructor arguments, setter methods and field injection. The underlying implementation relies on reflection, which means that there is no dependency on the Java EE 6 or Spring annotations as far as Mockito is concerned (obviously, you will get a compile error if you do not add the corresponding dependencies to the class path and your application will fail if there is no matching bean definition in runtime, but that has nothing to do with the unit test).</p>

<h2 id="limitations">Limitations</h2>

<p>There are some things you should be aware of when you are writing test this kind of test, such as</p>

<ul>
  <li>The order of which the dependency injection is attempted is <em>constructor injection</em>, <em>setter injection</em> and lastly <em>field injection</em>.</li>
  <li>Only one dependency injection strategy will occur for each test case. For example, if a suitable constructor is found, neither the setter injection nor the field injection will come to play.</li>
  <li>Mockito does not report if any dependency injection strategy fails.</li>
  <li>For constructor injection the “biggest” constructor is chosen, and <code class="language-plaintext highlighter-rouge">null</code> will be passed as argument for dependencies that are neither mocks nor spies.</li>
  <li>Fields may not be declared as <code class="language-plaintext highlighter-rouge">final</code> or <code class="language-plaintext highlighter-rouge">static</code> (but <code class="language-plaintext highlighter-rouge">private</code> fields are supported).</li>
</ul>

<p>Please read the documentation of the <a href="http://docs.mockito.googlecode.com/hg/1.9.0/org/mockito/InjectMocks.html">@InjectMocks</a> to learn about the details.</p>

<h2 id="dependency">Dependency</h2>

<p>Mockito 1.9.0</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="http://code.google.com/p/mockito/">Mockito</a></li>
  <li><a href="http://docs.mockito.googlecode.com/hg/1.9.0/org/mockito/InjectMocks.html">@InjectMocks</a></li>
  <li><a href="http://docs.mockito.googlecode.com/hg/1.9.0/org/mockito/Mock.html">@Mock</a></li>
  <li><a href="http://docs.mockito.googlecode.com/hg/1.9.0/org/mockito/runners/MockitoJUnitRunner.html">MockitoJUnitRunner</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2012-02-25T00:00:00+01:00">February 25, 2012</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/blog/2011/12/12/spring-integration-tests-part-ii-using-mock-objects/" class="pagination--pager" title="Spring Integration Tests, Part II, Using Mock Objects
">Previous</a>
    
    
      <a href="/blog/2012/04/07/continuous-deployment-versioning-and-git/" class="pagination--pager" title="Continuous Deployment, Versioning and Git
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/2020/03/23/aws-cdk-mfa/" rel="permalink">AWS CDK MFA
</a>
      
    </h2>
    


    <p class="archive__item-excerpt" itemprop="description">The AWS CDK (Cloud Development Kit) is a welcome contribution to the “Infrastructure as Code” family. It is a development framework that allows you to config...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/2018/09/11/aws-elasticsearch-javascript-client/" rel="permalink">AWS Elasticsearch JavaScript Client
</a>
      
    </h2>
    


    <p class="archive__item-excerpt" itemprop="description">Blog post that shows how an AWS Elasticsearch JavaScript Client can be implemented in addition to an example of an AWS Elasticsearch IAM policy implementation.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/2018/07/03/aws-glue-dev-endpoint-deleter/" rel="permalink">AWS Glue Dev Endpoint Deleter
</a>
      
    </h2>
    


    <p class="archive__item-excerpt" itemprop="description">Blog post that describes how you can decrease the costs associated with AWS Glue developer endpoint by implementing an AWS Lambda function that deletes them ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/2017/11/22/aws-cli-mfa/" rel="permalink">AWS CLI MFA
</a>
      
    </h2>
    


    <p class="archive__item-excerpt" itemprop="description">Blog post that describes how you can use a CloudFormation Template and AWS CLI profiles to enforce MFA for AWS CLI users.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Mattias Severson. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
